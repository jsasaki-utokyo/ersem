# ERSEM栄養塩制限モデル：東京湾への適用に向けた分析と改良提案

## 1. 現行ERSEMの栄養塩モデル構造

### 1.1 Droop細胞内蓄積量モデル＋アフィニティの混成システム

ERSEMは、Droop細胞内蓄積量（cell quota）モデルとアフィニティに基づく栄養塩取込みを組み合わせた**混成システム**を採用している。これは単純なMonod（外部濃度）モデルとは本質的に異なる。

**増殖制限**（内部蓄積量、Droopモデル）：
```
iNp = MIN(1, MAX(0, (qpc - qplc) / (xqcp * qpRPIcX - qplc)))
iNn = MIN(1, MAX(0, (qnc - qnlc) / (xqcn * qnRPIcX - qnlc)))
```
ここで、`qpc`と`qnc`は現在の内部P:CおよびN:C比、`qplc`と`qnlc`は最小（生存限界）蓄積量、`xqcp * qpRPIcX`は増殖能力が最大に達する閾値蓄積量である。増殖は外部濃度ではなく**内部**栄養塩蓄積量に依存する。

**栄養塩取込み**（アフィニティに基づく線形モデル）：
```
rump  = qurp * N1p * c        （最大到達可能P取込み）
rumn3 = qun3 * N3n * c        （最大到達可能NO3取込み）
rumn4 = qun4 * N4n * c        （最大到達可能NH4取込み）
```
ここで、`qurp`、`qun3`、`qun4`はアフィニティパラメータ（m^3/mg C/d）である。明示的な飽和のない**一次線形取込みモデル**である。

**取込み制御**（需要による上限）：
```
fN1PIp = MIN(rump, runp + misp)
```
実際の取込みは、アフィニティに基づく最大値と需要駆動型の蓄積量補充項の小さい方となる。これにより、内部蓄積量が満たされた際の暗黙的な飽和が実現される。

**ケイ酸塩制限**（モデル中で唯一のMonod型）：
```
iNs = MIN(1, N5s / (N5s + chs))
```
ケイ酸塩のみが外部濃度を用いた古典的なMonod半飽和定数モデルを使用する。

### 1.2 主要パラメータとその役割

| パラメータ | 単位 | 役割 | 生態学的解釈 |
|-----------|------|------|-------------|
| `sum` | 1/d | 最大比生産性 | 最適条件下での最大増殖速度 |
| `qun3`, `qun4` | m^3/mg C/d | Nアフィニティ | 低外部[N]での取込み効率 |
| `qurp` | m^3/mg C/d | Pアフィニティ | 低外部[P]での取込み効率 |
| `qnlc` | mmol N/mg C | 最小N:C蓄積量 | 生存限界閾値；これ以下で増殖停止 |
| `qplc` | mmol P/mg C | 最小P:C蓄積量 | Pの生存限界閾値 |
| `xqcn`, `xqcp` | - | 制限閾値 | 制限が解除される蓄積量レベル |
| `xqn`, `xqp` | - | 最大蓄積量倍率 | 贅沢取込み容量（Redfield比に対する比率） |
| `snplux` | 1/d | 贅沢取込み速度 | 最小値を超えて内部蓄積量が充填される速度 |
| `chs` | mmol Si/m^3 | Si半飽和定数 | ケイ酸塩のMonod Ks（珪藻のみ） |
| `phim` | mg Chl/mg C | 最大Chl:C比 | 単位バイオマスあたりのクロロフィル合成量を制御 |

### 1.3 ERSEMのアフィニティとMonodのKsの関係

Michaelis-Menten取込み方程式は、低基質濃度において以下のように近似される：

```
V ≈ (Vmax / Ks) × S
```

この初期勾配が**栄養塩アフィニティ**である（Healey, 1980; Aksnes & Egge, 1991）。従って：

```
ERSEMアフィニティ ≈ Vmax / Ks   （単位バイオマス炭素あたり）
```

ERSEMの線形取込みモデルはMonod動力学の**低濃度領域**を表現している。東京湾のような富栄養環境（DIN 10-50 mmol N/m^3）では、明示的な飽和がないため取込みが非現実的に高くなり得るが、内部蓄積量が充填されるにつれてDroop蓄積量システムが暗黙的な飽和を提供する。

## 2. 植物プランクトン競争理論：r-K選択と栄養塩戦略

### 2.1 機能的形質フレームワーク

植物プランクトンの栄養塩をめぐる競争は、機能的形質フレームワークに従う（Litchman et al., 2007; Litchman & Klausmeier, 2008）：

**r-戦略種**（ブルーム形成種、例：*Skeletonema*のような珪藻）：
- 高い最大増殖速度（Vmax）
- 高い半飽和定数（Ks）-- 最大取込みに高栄養塩が必要
- 低～中程度のVmax/Ks比 → **低いバイオマス比アフィニティ**
- パルス的な高栄養塩環境（ブルーム）で繁栄

**K-戦略種**（定常状態のスペシャリスト、例：*Synechococcus*のような超微小植物プランクトン）：
- 低い最大増殖速度
- 非常に低いKs -- 微量栄養塩でも効率的に取込み
- 高いVmax/Ks比 → **高いバイオマス比アフィニティ**
- 安定した低栄養塩環境で繁栄

**渦鞭毛藻類**（混合栄養戦略種）：
- 低い増殖速度かつ高いKs → **最低のアフィニティ**
- 鉛直移動、混合栄養、毒素生産で補償
- 栄養塩取込み効率ではなく行動戦略に依存

### 2.2 Droopモデルにおける競争結果

Droop蓄積量モデルにおける定常状態の競争結果はR*に依存する（Tilman, 1982）。可変内部蓄積量モデルでは、複数のパラメータの相互作用に依存する（Grover, 1991）：

```
実効R* ~ （死亡率 × q_min）/ アフィニティ
```

**競争指数**は`q_min / アフィニティ`で近似できる。低い最小蓄積量かつ高いアフィニティを持つ種が最低のR*を持ち、栄養塩枯渇条件下で勝利する。

**直感に反する側面**：高いアフィニティ単独でも低い最小蓄積量単独でも、競争的成功は保証されない。両方を合わせて考慮する必要がある。

### 2.3 細胞サイズのスケーリング則

Edwards et al. (2012)はアロメトリックスケーリング関係を確立した：

| 形質 | 細胞体積との関係 | 結果 |
|------|-----------------|------|
| Vmax（絶対値） | サイズとともに増加 | 大きい細胞は1細胞あたりより多く取込む |
| Ks | サイズとともに増加 | 大きい細胞はより多くの環境栄養塩が必要 |
| Vmax/Ks（バイオマス比アフィニティ） | サイズとともに**減少** | 小さい細胞の方が低栄養塩環境での競争力が高い |
| 最大増殖速度 | サイズとともに**減少** | 小さい細胞の方が単位バイオマスあたり速く増殖 |
| 最小蓄積量（q_min） | サイズとともに増加 | 大きい細胞はより多くの蓄積栄養塩が必要 |

期待されるアフィニティの順序：
```
超微小植物プランクトン > ナノ鞭毛藻 > 珪藻 > 渦鞭毛藻
```

## 3. 東京湾における現行パラメータの評価

### 3.1 現在のP1-P4設定

| パラメータ | P1 珪藻 | P2 ナノ | P3 ピコ | P4 マイクロ | 生態学的期待値 |
|-----------|---------|---------|---------|------------|---------------|
| sum (1/d) | 1.375 | 1.625 | 2.0 | 1.1125 | P1は富栄養珪藻としてより高い値が可能 |
| qun3 | 0.0025 | 0.004 | 0.006 | 0.002 | 順序は正しい：ピコ > ナノ > 珪藻 > マイクロ |
| qun4 | 0.0025 | 0.004 | 0.007 | 0.002 | 順序は正しい |
| qurp | 0.003 | 0.004 | 0.006 | 0.002 | 順序は正しい |
| qnlc | 0.0042 | 0.005 | 0.006 | 0.0042 | **不適切**：P3が最大、本来は最小であるべき |
| qplc | 0.0001 | 0.000225 | 0.00035 | 0.0001 | **不適切**：P3が最大、本来は最小であるべき |
| phim | 0.06 | 0.025 | 0.015 | 0.045 | P2、P3は富栄養条件に対して低すぎる |
| chs (Si) | 0.2 | - | - | - | 低すぎる；文献値 0.5-5.0 mmol/m^3 |

### 3.2 競争指数分析（q_min / アフィニティ）

| グループ | qnlc/qun3 (N) | qplc/qurp (P) | 解釈 |
|---------|----------------|----------------|------|
| P1（珪藻） | 1.68 | 0.033 | 中程度のN競争者、強いP競争者 |
| P2（ナノ） | 1.25 | 0.056 | 両方とも中程度 |
| P3（ピコ） | 1.00 | 0.058 | 最良のN競争者だが、優位性は弱い |
| P4（マイクロ） | 2.10 | 0.050 | 最も弱いN競争者 |

**問題点**：P3の窒素における競争優位性が小さすぎる（1.00 対 P2の1.25）。最小蓄積量を修正すれば、P3は遥かに低い比率（～0.5）となり、より強い種間分化が実現される。

### 3.3 特定された主要課題

1. **最小蓄積量の順序が逆転**：P3（超微小植物プランクトン）が最も高い最小蓄積量（qnlc=0.006、qplc=0.00035）を持ち、理論と矛盾する。K-戦略種は最も低い最小蓄積量を持つべきである。

2. **P1のToptが低すぎる**：現在のTopt=15°Cは夏季（25-28°C）の珪藻増殖を抑制するが、東京湾の珪藻（*Skeletonema*）は通年ブルームする。Toptを18-22°Cに引き上げるべきである。

3. **P2、P3のphimが低すぎる**：最大Chl:C比の0.025および0.015は富栄養条件に対して低すぎる。栄養塩充足条件の文献値：0.03-0.06 mg Chl/mg C。

4. **摂食圧**：ERSEMのデフォルト値は北海用に調整されている。東京湾の超富栄養条件では、摂食速度の低減が必要と考えられる。

## 4. 診断：クロロフィルa濃度の15倍過小評価

### 4.1 観測値 vs モデル値

- **観測値**：～20 mg Chl/m^3 表層年平均（東京湾内湾、川崎局）
- **モデル値**：～1.35 mg Chl/m^3
- **倍率**：～15倍の過小評価

### 4.2 寄与要因（推定影響度順）

| 要因 | 推定影響度 | メカニズム |
|------|-----------|-----------|
| **摂食圧が強すぎる** | 2-5倍 | 北海用に調整されたZ4/Z5/Z6が富栄養ブルームを抑制 |
| **P1のToptが低すぎる** | 2-3倍 | T > 20°Cの夏季に珪藻生産が抑制される |
| **P2/P3のphimが低すぎる** | 1.3-1.5倍 | 植物プランクトン炭素あたりのChlが不足 |
| **sumをより高くできる** | 1.3-1.5倍 | 特にP1の富栄養条件 |
| **1Dモデルの限界** | 1.5-2倍 | 側方栄養塩供給（河川、下水）の欠如 |
| **最小蓄積量の順序** | 1.1-1.3倍 | 弱い種間分化が群集全体の生産性を低下 |

複合効果：2.5 × 2 × 1.4 × 1.3 × 1.5 × 1.2 ≈ **16倍**、観測される乖離と整合的。

### 4.3 富栄養沿岸水域の典型的なChl:C比

| 条件 | C:Chl (g:g) | Chl:C (g:g) |
|------|-------------|-------------|
| 富栄養河口域、平均 | 20-40 | 0.025-0.050 |
| 夏季強光 | 50-100 | 0.010-0.020 |
| 春季ブルーム | 20-30 | 0.033-0.050 |
| 深層/弱光 | 15-25 | 0.040-0.067 |

出典：Jakobsen & Markager (2016)、Geider et al. (1997, 1998)

## 5. 改良提案

### 5.1 提案A：最小蓄積量の順序修正（コード変更なし）

生態学的に不整合な最小蓄積量を`fabm.yaml`で修正：

| パラメータ | P1 珪藻 | P2 ナノ | P3 ピコ | P4 マイクロ |
|-----------|---------|---------|---------|------------|
| qnlc（現在） | 0.0042 | 0.005 | 0.006 | 0.0042 |
| qnlc（提案） | 0.0042 | 0.0035 | 0.0025 | 0.0042 |
| qplc（現在） | 0.0001 | 0.000225 | 0.00035 | 0.0001 |
| qplc（提案） | 0.0001 | 0.00012 | 0.00008 | 0.0001 |

**根拠**：超微小植物プランクトンは細胞が小さく、単位バイオマスあたりの代謝要求量が低い。より低い細胞内栄養塩レベルで生存可能である（Litchman et al., 2007; Edwards et al., 2012）。

### 5.2 提案B：非珪藻グループのphim増加（コード変更なし）

| パラメータ | P1 珪藻 | P2 ナノ | P3 ピコ | P4 マイクロ |
|-----------|---------|---------|---------|------------|
| phim（現在） | 0.06 | 0.025 | 0.015 | 0.045 |
| phim（提案） | 0.06 | 0.04 | 0.03 | 0.05 |

**根拠**：富栄養水域では、栄養塩充足細胞はより高いChl:C比を維持する。現在のP2/P3の値は貧栄養条件により適切である（Geider et al., 1998）。

### 5.3 提案C：摂食パラメータの調整（コード変更なし）

東京湾の超富栄養条件に対してトップダウン制御を低減：

| パラメータ | 現在値 | 提案値 | グループ |
|-----------|--------|--------|---------|
| Z5 sum | 1.25 | 0.8-1.0 | 微小動物プランクトン最大摂食速度 |
| Z5 pu | 0.5 | 0.3-0.4 | 微小動物プランクトン同化効率 |
| Z4 sum | 1.0 | 0.8 | 中型動物プランクトン最大摂食速度 |
| Z4 pu | 0.6 | 0.4-0.5 | 中型動物プランクトン同化効率 |

**根拠**：超富栄養湾では、ブルーム時に植物プランクトン増殖が動物プランクトン摂食を定常的に上回る。北海用に調整された摂食速度は東京湾条件には強すぎる。

### 5.4 提案D：P1のCTMI温度範囲の拡大（コード変更なし）

| パラメータ | 現在値 | 提案値 | 根拠 |
|-----------|--------|--------|------|
| P1 Topt | 15.0 | 18-22 | 東京湾珪藻は通年ブルーム；15°Cは制限的すぎる |
| P1 Tmax | 30.0 | 32-33 | 夏季ピーク温度でもある程度の増殖を許容 |
| P4 Tmin | 10.0 | 12-14 | 範囲を狭めてより強い季節性を実現 |

### 5.5 提案E：P1のケイ酸塩半飽和定数の増加（コード変更なし）

| パラメータ | 現在値 | 提案値 | 根拠 |
|-----------|--------|--------|------|
| P1 chs | 0.2 | 1.0-3.0 | *Skeletonema*のKs(Si)文献値：1-3 mmol/m^3 |

**根拠**：現在の値（0.2 mmol/m^3）では珪藻がSi制限をほぼ受けない。1.0-3.0に引き上げることで、ブルーム終息時の現実的なケイ酸塩枯渇メカニズムが実現される（Paasche, 1973; Nelson & Treguer, 1992）。

### 5.6 提案F：栄養塩取込みへのオプションMonod飽和の追加（コード変更）

**動機**：ERSEMの線形アフィニティモデルには取込み飽和がない。東京湾の富栄養条件（DIN 10-50 mmol/m^3）では、非現実的に高い取込み速度が生じ得る。オプションのMichaelis-Menten飽和を追加すれば：
- 高栄養塩濃度での取込み速度に上限を設定できる
- 半飽和定数（Ks）を種ごとのチューニングパラメータとして使用できる
- 明示的なr-K戦略の分化が可能になる

**評価**：これはより大きなコード変更であり、最優先ではない可能性がある。Droop蓄積量の上限と組み合わせた線形アフィニティモデルは適切に機能する。ただし、明示的なKsはパラメータチューニングにおいてより直感的であり、文献値と直接比較可能である。

**推奨**：このコード変更は延期する。まず提案A-E（パラメータチューニングのみ）に注力し、結果を評価してからFortranコードの修正を検討する。

## 6. 推奨v5 Optunaチューニング戦略

### 6.1 パラメータ選定

分析に基づき、v5には以下の14パラメータを推奨：

**増殖速度**（4パラメータ）：
| パラメータ | インスタンス | 範囲 | 根拠 |
|-----------|------------|------|------|
| sum | P1 | 1.0-3.0 | 珪藻：富栄養条件での高増殖 |
| sum | P2 | 1.0-2.5 | ナノ鞭毛藻 |
| sum | P3 | 1.0-3.0 | 超微小植物プランクトン |
| sum | P4 | 0.3-1.0 | 渦鞭毛藻：低増殖速度 |

**温度**（2パラメータ）：
| パラメータ | インスタンス | 範囲 | 根拠 |
|-----------|------------|------|------|
| Topt | P1 | 15-25 | 珪藻最適温度 |
| Topt | P4 | 22-30 | 渦鞭毛藻最適温度 |

**栄養塩取込みアフィニティ**（4パラメータ）：
| パラメータ | インスタンス | 範囲 | 根拠 |
|-----------|------------|------|------|
| qun3 | P1 | 0.001-0.005 | 珪藻硝酸塩アフィニティ |
| qun3 | P4 | 0.0005-0.003 | 渦鞭毛藻硝酸塩アフィニティ |
| qurp | P1 | 0.001-0.006 | 珪藻リン酸塩アフィニティ |
| chs | P1 | 0.2-5.0 | 珪藻ケイ酸塩半飽和定数 |

**摂食**（2パラメータ）：
| パラメータ | インスタンス | 範囲 | 根拠 |
|-----------|------------|------|------|
| sum | Z5 | 0.5-1.5 | 微小動物プランクトン摂食速度 |
| pu | Z5 | 0.2-0.6 | 微小動物プランクトン同化効率 |

**生態系プロセス**（2パラメータ）：
| パラメータ | インスタンス | 範囲 | 根拠 |
|-----------|------------|------|------|
| sN4N3 | pel_nit | 0.05-1.0 | 硝化速度 |
| sum | B1 | 1.5-5.0 | 細菌分解速度 |

### 6.2 チューニング前の固定変更

Optuna最適化の前に、提案A（最小蓄積量の修正）と提案B（P2/P3のphim増加）を固定パラメータ変更として適用する。これらは明確な理論的根拠に基づいており、最適化対象とすべきではない。

### 6.3 目的関数の設計

v4のChl-a目的関数には問題があった（RMSE_relが～1.5で最適化を支配）。推奨される変更：

**オプション1：Chl-aの対数変換**
```python
score_chl = 0.5 * (1 - corr(log(obs+1), log(mod+1))) + 0.5 * RMSE(log(obs+1), log(mod+1)) / std(log(obs+1))
```
桁違いのスケール差を自然に処理する。

**オプション2：Chl-aの相関のみ**
```python
score_chl = 1 - corr(obs, mod)
```
絶対値ではなく時間的パターンに注目する。

**推奨**：オプション1（対数変換）。正しいタイミングと正しい絶対値の両方を評価し、かつ絶対スケールの不一致に支配されない。

## 7. 文献

- Aksnes, D.L. & Egge, J.K. (1991). A theoretical model for nutrient uptake in phytoplankton. *Mar. Ecol. Prog. Ser.*, 70, 65-72.
- Butenschon, M. et al. (2016). ERSEM 15.06: a generic model for marine biogeochemistry. *Geosci. Model Dev.*, 9, 1293-1339.
- Droop, M.R. (1968). Vitamin B12 and marine ecology. IV. *J. Mar. Biol. Assoc. UK*, 48, 689-733.
- Droop, M.R. (1973). Some thoughts on nutrient limitation in algae. *J. Phycol.*, 9, 264-272.
- Edwards, K.F. et al. (2012). Allometric scaling and taxonomic variation in nutrient utilization traits. *Limnol. Oceanogr.*, 57(2), 554-566.
- Eppley, R.W. et al. (1969). Half-saturation constants for uptake of nitrate and ammonium by marine phytoplankton. *Limnol. Oceanogr.*, 14, 912-920.
- Flynn, K.J. (2003). Modelling multi-nutrient interactions in phytoplankton. *Prog. Oceanogr.*, 56, 249-279.
- Geider, R.J. et al. (1997). Dynamic model of phytoplankton growth and acclimation. *Mar. Ecol. Prog. Ser.*, 148, 187-200.
- Geider, R.J. et al. (1998). A dynamic regulatory model of phytoplanktonic acclimation. *Limnol. Oceanogr.*, 43, 679-694.
- Grover, J.P. (1991). Resource competition in a variable environment. *Am. Nat.*, 138, 811-835.
- Healey, F.P. (1980). Slope of the Monod equation as an indicator of advantage in nutrient competition. *Microb. Ecol.*, 5, 281-286.
- Jakobsen, H.H. & Markager, S. (2016). Carbon-to-chlorophyll ratio for phytoplankton in temperate coastal waters. *Limnol. Oceanogr.*, 61, 1853-1866.
- Litchman, E. et al. (2007). The role of functional traits and trade-offs in structuring phytoplankton communities. *Ecol. Lett.*, 10, 1170-1181.
- Litchman, E. & Klausmeier, C.A. (2008). Trait-based community ecology of phytoplankton. *Annu. Rev. Ecol. Evol. Syst.*, 39, 615-639.
- Nakada, S. (2021). Phytoplankton species abundance in Tokyo Bay. *Ecol. Res.*
- Nelson, D.M. & Treguer, P. (1992). Role of silicon as a limiting nutrient to Antarctic diatoms. *Mar. Ecol. Prog. Ser.*, 85, 263-272.
- Paasche, E. (1973). Silicon and the ecology of marine plankton diatoms. *Mar. Biol.*, 19, 117-126.
- Smayda, T.J. (1997). Harmful algal blooms: their ecophysiology and general relevance. *Limnol. Oceanogr.*, 42, 1137-1153.
- Tilman, D. (1982). *Resource Competition and Community Structure*. Princeton University Press.
